!function(window){"use strict";var support_animations=Modernizr.cssanimations,animEndEventName={WebkitAnimation:"webkitAnimationEnd",OAnimation:"oAnimationEnd",msAnimation:"MSAnimationEnd",animation:"animationend"}[Modernizr.prefixed("animation")];function extend(a,b){for(var key in b)b.hasOwnProperty(key)&&(a[key]=b[key]);return a}function Stack(el,options){this.el=el,this.options=extend({},this.options),extend(this.options,options),this.items=[].slice.call(this.el.children),this.itemsTotal=this.items.length,(this.options.infinite&&this.options.visible>=this.itemsTotal||!this.options.infinite&&this.options.visible>this.itemsTotal||this.options.visible<=0)&&(this.options.visible=1),this.current=0,this._init()}Stack.prototype.options={perspective:1e3,perspectiveOrigin:"50% -50%",visible:3,infinite:!0,onEndStack:function(){return!1},stackItemsAnimation:{duration:500,type:dynamics.bezier,points:[{x:0,y:0,cp:[{x:.25,y:.1}]},{x:1,y:1,cp:[{x:.25,y:1}]}]},stackItemsAnimationDelay:0},Stack.prototype._init=function(){this.el.style.WebkitPerspective=this.el.style.perspective=this.options.perspective+"px",this.el.style.WebkitPerspectiveOrigin=this.el.style.perspectiveOrigin=this.options.perspectiveOrigin;for(var i=0;i<this.itemsTotal;++i){var item=this.items[i];i<this.options.visible?(item.style.opacity=1,item.style.pointerEvents="auto",item.style.zIndex=0===i?parseInt(this.options.visible+1):parseInt(this.options.visible-i),item.style.WebkitTransform=item.style.transform="translate3d(0px, 0px, "+parseInt(-50*i)+"px)"):item.style.WebkitTransform=item.style.transform="translate3d(0,0,-"+parseInt(50*this.options.visible)+"px)"}classie.add(this.items[this.current],"stack__item--current")},Stack.prototype.reject=function(callback){this._next("reject",callback)},Stack.prototype.accept=function(callback){this._next("accept",callback)},Stack.prototype.restart=function(){this.hasEnded=!1,this._init()},Stack.prototype._next=function(action,callback){if(!(this.isAnimating||!this.options.infinite&&this.hasEnded)){this.isAnimating=!0;var currentItem=this.items[this.current];classie.remove(currentItem,"stack__item--current"),classie.add(currentItem,"accept"===action?"stack__item--accept":"stack__item--reject");var self=this;!function(el,callback){var onEndCallbackFn=function(ev){if(support_animations){if(ev.target!=this)return;this.removeEventListener(animEndEventName,onEndCallbackFn)}callback&&"function"==typeof callback&&callback.call()};support_animations?el.addEventListener(animEndEventName,onEndCallbackFn):onEndCallbackFn()}(currentItem,function(){currentItem.style.opacity=0,currentItem.style.pointerEvents="none",currentItem.style.zIndex=-1,currentItem.style.WebkitTransform=currentItem.style.transform="translate3d(0px, 0px, -"+parseInt(50*self.options.visible)+"px)",classie.remove(currentItem,"accept"===action?"stack__item--accept":"stack__item--reject"),self.items[self.current].style.zIndex=self.options.visible+1,self.isAnimating=!1,callback&&callback(),self.options.infinite||0!==self.current||(self.hasEnded=!0,self.options.onEndStack(self))});for(var i=0;i<this.itemsTotal&&!(i>=this.options.visible);++i){if(this.options.infinite)pos=this.current+i<this.itemsTotal-1?this.current+i+1:i-(this.itemsTotal-this.current-1);else{if(this.current+i>=this.itemsTotal-1)break;var pos=this.current+i+1}var item=this.items[pos],animateStackItems=function(item,i){item.style.pointerEvents="auto",item.style.opacity=1,item.style.zIndex=parseInt(self.options.visible-i),dynamics.animate(item,{translateZ:parseInt(-50*i)},self.options.stackItemsAnimation)};setTimeout(function(item,i){return function(){var preAnimation;if(self.options.stackItemsPreAnimation&&(preAnimation="accept"===action?self.options.stackItemsPreAnimation.accept:self.options.stackItemsPreAnimation.reject),preAnimation){var animProps={};for(var key in preAnimation.animationProperties){var interval=preAnimation.elastic?preAnimation.animationProperties[key]/self.options.visible:0;animProps[key]=preAnimation.animationProperties[key]-Number(i*interval)}animProps.translateZ=parseInt(-50*(i+1)),preAnimation.animationSettings.complete=function(){animateStackItems(item,i)},dynamics.animate(item,animProps,preAnimation.animationSettings)}else animateStackItems(item,i)}}(item,i),this.options.stackItemsAnimationDelay)}this.current=this.current<this.itemsTotal-1?this.current+1:0,classie.add(this.items[this.current],"stack__item--current")}},window.Stack=Stack}(window);